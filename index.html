<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>2x4 MIDI Pad (C4) — Responsive Scalable Pads</title>
<style>
  :root{--bg:#071022;--panel:#0b1220;--accent:#60a5fa;--muted:#9ca3af;--scale:1}
  html,body{height:100%;margin:0;background:var(--bg);color:#e6eef8;font-family:Inter,system-ui,Segoe UI,Roboto,Arial}
  .container{display:flex;flex-wrap:wrap;align-items:flex-start;justify-content:center;height:100%;padding:20px;box-sizing:border-box;gap:20px}
  .pad-grid{display:grid;grid-template-columns:repeat(2,minmax(0,calc(280px * var(--scale))));grid-template-rows:repeat(4,minmax(0,calc(200px * var(--scale))));gap:calc(18px * var(--scale));touch-action:manipulation;-webkit-tap-highlight-color:transparent;flex-shrink:0}
  .pad{background:#081827;border-radius:calc(16px * var(--scale));display:flex;flex-direction:column;align-items:center;justify-content:center;user-select:none;cursor:pointer;-webkit-user-select:none;transition:transform .06s;box-shadow:0 10px 24px rgba(2,6,23,.6)}
  .pad:active,.pad.active{transform:translateY(3px);box-shadow:0 5px 12px rgba(2,6,23,.5)}
  .pad .note{font-weight:700;font-size:calc(28px * var(--scale))}
  .pad .midi{font-size:calc(16px * var(--scale));color:var(--muted);margin-top:calc(10px * var(--scale))}
  .controls{display:flex;flex-direction:column;gap:12px;min-width:220px;flex-shrink:0}
  select,input[type=range],button{background:transparent;border:1px solid rgba(255,255,255,0.04);padding:8px;border-radius:8px;color:var(--accent)}
  label{font-size:14px;color:var(--muted)}
  .hint{font-size:12px;color:var(--muted)}
  button{background:var(--accent);color:#042033;border:none}

  @media(max-width:600px){
    .container{flex-direction:column;align-items:center;}
    .pad-grid{grid-template-columns:repeat(2,minmax(0,45vw));grid-template-rows:repeat(4,minmax(0,calc(200px * var(--scale))));gap:12px;}
    .controls{width:90%;margin-top:15px;}
  }
</style>
</head>
<body>
  <div class="container">
    <div class="pad-grid" id="padGrid"></div>

    <div class="controls" id="controls">
      <label class="hint">Octave shift (semitones: ±12)</label>
      <input id="octave" type="range" min="-2" max="2" value="0" step="1">
      <div class="hint">Current shift: <span id="octVal">0</span></div>

      <label class="hint">Velocity</label>
      <input id="velocity" type="range" min="1" max="127" value="100">
      <div class="hint">Velocity: <span id="velVal">100</span></div>

      <label class="hint">Pad Size</label>
      <input id="padScale" type="range" min="0.5" max="2" value="1" step="0.1">
      <div class="hint">Scale: <span id="scaleVal">1.0</span>x</div>

      <label class="hint">MIDI Output</label>
      <select id="midiOutput"></select>

      <button id="allOff">All Notes Off</button>
      <div class="hint">Tip: use loopMIDI to create/select a virtual port. Touchscreens: uses touchstart for near-zero latency.</div>
    </div>
  </div>

<script>
const NOTE_NAMES = ['C','C#','D','D#','E','F','F#','G','G#','A','A#','B'];
const BASE_START = 60; // C4
const PAD_COUNT = 8;

function noteName(n){ return NOTE_NAMES[n % 12] + (Math.floor(n/12)-1); }

const padGrid = document.getElementById('padGrid');
const octaveEl = document.getElementById('octave');
const octVal = document.getElementById('octVal');
const velocityEl = document.getElementById('velocity');
const velVal = document.getElementById('velVal');
const padScaleEl = document.getElementById('padScale');
const scaleVal = document.getElementById('scaleVal');
const midiSelect = document.getElementById('midiOutput');
const allOffBtn = document.getElementById('allOff');

let midiAccess = null;
let selectedOutput = null;
let octaveShift = 0;

const padOnMsgs = new Array(PAD_COUNT);
const padOffMsgs = new Array(PAD_COUNT);
const padEls = new Array(PAD_COUNT);

(function buildPads(){
  for(let i=0;i<PAD_COUNT;i++){
    const el = document.createElement('div');
    el.className = 'pad';
    const midi = BASE_START + i;
    el.innerHTML = `<div class="note">${noteName(midi)}</div><div class="midi">MIDI ${midi}</div>`;
    padGrid.appendChild(el);
    padEls[i] = el;

    padOnMsgs[i] = new Uint8Array([0x90, midi & 0x7f, Number(velocityEl.value) & 0x7f]);
    padOffMsgs[i] = new Uint8Array([0x80, midi & 0x7f, 0x00]);

    el.addEventListener('touchstart', (e)=>{ e.preventDefault(); el.classList.add('active'); selectedOutput && selectedOutput.send(padOnMsgs[i]); }, {passive:false});
    el.addEventListener('touchend',   (e)=>{ e.preventDefault(); el.classList.remove('active'); selectedOutput && selectedOutput.send(padOffMsgs[i]); }, {passive:false});
    el.addEventListener('mousedown',  ()=>{ el.classList.add('active'); selectedOutput && selectedOutput.send(padOnMsgs[i]); });
    el.addEventListener('mouseup',    ()=>{ el.classList.remove('active'); selectedOutput && selectedOutput.send(padOffMsgs[i]); });
    el.addEventListener('mouseleave', ()=>{ el.classList.remove('active'); selectedOutput && selectedOutput.send(padOffMsgs[i]); });
  }
})();

function updatePadMessages(){
  const vel = Number(velocityEl.value) & 0x7f;
  const shift = Number(octaveEl.value) * 12;
  octaveShift = Number(octaveEl.value);
  octVal.textContent = octaveShift;
  velVal.textContent = vel;

  for(let i=0;i<PAD_COUNT;i++){
    const midi = (BASE_START + i + shift) & 0x7f;
    const el = padEls[i];
    const noteDiv = el.firstElementChild;
    const midiDiv = noteDiv.nextElementSibling;
    noteDiv.textContent = noteName(midi);
    midiDiv.textContent = 'MIDI ' + midi;
    padOnMsgs[i][1] = midi;
    padOnMsgs[i][2] = vel;
    padOffMsgs[i][1] = midi;
  }
}

padScaleEl.addEventListener('input', ()=>{
  const scale = parseFloat(padScaleEl.value);
  document.documentElement.style.setProperty('--scale', scale);
  scaleVal.textContent = scale.toFixed(1);
});

async function initMIDI(){
  if(!navigator.requestMIDIAccess){ return; }
  try{
    midiAccess = await navigator.requestMIDIAccess({sysex:false});
    midiAccess.onstatechange = populateOutputs;
    populateOutputs();
  }catch(e){ }
}

function populateOutputs(){
  midiSelect.innerHTML = '';
  const outs = Array.from(midiAccess.outputs.values());
  for(const o of outs){
    const opt = document.createElement('option');
    opt.value = o.id; opt.textContent = o.name || (o.manufacturer || 'MIDI Output');
    midiSelect.appendChild(opt);
  }
  if(outs.length) { selectedOutput = outs[0]; midiSelect.value = selectedOutput.id; }
}

midiSelect.addEventListener('change', ()=>{ selectedOutput = midiAccess.outputs.get(midiSelect.value); });

allOffBtn.addEventListener('click', ()=>{
  if(!midiAccess) return;
  midiAccess.outputs.forEach(o=>{ try{ o.send([0xB0,0x7B,0x00]); }catch(e){} });
  padEls.forEach(p=>p.classList.remove('active'));
});

octaveEl.addEventListener('input', ()=>{ updatePadMessages(); });
velocityEl.addEventListener('input', ()=>{ updatePadMessages(); });

updatePadMessages();
initMIDI();
</script>
</body>
</html>
